description: This playbook test SecurityAndCompliance integration
id: O365-SecurityAndCompliance-Test
inputs:
- description: The name of the compliance search.
  key: search_name
  playbookInputQuery:
  required: true
  value:
    simple: Demisto-Test
- description: Text search string or a query that's formatted by using the Keyword
    Query Language (KQL).
  key: kql
  playbookInputQuery:
  required: true
  value:
    simple: Rodrigo
- description: Description for the compliance search.
  key: description
  playbookInputQuery:
  required: true
  value:
    simple: Demisto description
- description: Whether to include mailboxes other than regular user mailboxes in the
    compliance search.
  key: allow_not_found_exchange_locations
  playbookInputQuery:
  required: true
  value:
    simple: "true"
- description: Mailboxes/distribution group to include, or you can use the value "All"
    to include all. (Comma seprated)
  key: exchange_location
  playbookInputQuery:
  required: true
  value:
    simple: avishai@demistodev.onmicrosoft.com,notexists@demistodev.onmicrosoft.com
name: O365-SecurityAndCompliance-Test
outputs: []
starttaskid: "0"
tasks:
  "0":
    id: "0"
    ignoreworker: false
    nexttasks:
      '#none#':
      - "30"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 0f1f7051-81d0-4868-8f33-a3e636ca2bc5
      iscommand: false
      name: ""
      version: -1
    taskid: 0f1f7051-81d0-4868-8f33-a3e636ca2bc5
    timertriggers: []
    type: start
    view: |-
      {
        "position": {
          "x": 152.5,
          "y": 50
        }
      }
  "2":
    conditions:
    - condition:
      - - left:
            iscontext: true
            value:
              simple: O365.SecurityAndCompliance.ContentSearch.Search.AllowNotFoundExchangeLocationsEnabled
          operator: isEqualString
          right:
            value:
              simple: "true"
      - - left:
            iscontext: true
            value:
              simple: O365.SecurityAndCompliance.ContentSearch.Search.Description
          operator: isEqualString
          right:
            value:
              simple: Demisto description
      - - left:
            iscontext: true
            value:
              simple: O365.SecurityAndCompliance.ContentSearch.Search.ExchangeLocation
          operator: containsGeneral
          right:
            value:
              simple: avishai@demistodev.onmicrosoft.com
      - - left:
            iscontext: true
            value:
              simple: O365.SecurityAndCompliance.ContentSearch.Search.ContentMatchQuery
          operator: isEqualString
          right:
            value:
              simple: Rodrigo
      label: "yes"
    id: "2"
    ignoreworker: false
    nexttasks:
      '#default#':
      - "10"
      "yes":
      - "4"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: 'Validate compliance search creation with all additional arguments. '
      id: 3b27fd01-8337-420e-8cf1-4e98b1954724
      iscommand: false
      name: Validate compliance search created
      type: condition
      version: -1
    taskid: 3b27fd01-8337-420e-8cf1-4e98b1954724
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 152.5,
          "y": 370
        }
      }
  "3":
    id: "3"
    ignoreworker: false
    nexttasks:
      '#none#':
      - "29"
    note: false
    quietmode: 0
    scriptarguments:
      retry-count:
        simple: "10"
      search_name:
        simple: ${inputs.search_name}
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Remove compliance search by name from the Security & Compliance
        Center.
      id: 2b5be80a-e454-4048-8d2e-167ba9be5a68
      iscommand: true
      name: Remove search
      script: '|||o365-sc-remove-search'
      type: regular
      version: -1
    taskid: 2b5be80a-e454-4048-8d2e-167ba9be5a68
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 612.5,
          "y": 3345
        }
      }
  "4":
    id: "4"
    ignoreworker: false
    nexttasks:
      '#none#':
      - "25"
    note: false
    quietmode: 0
    scriptarguments:
      all:
        simple: "yes"
      index: {}
      key: {}
      keysToKeep: {}
      subplaybook: {}
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Delete field from context
      id: b38e833a-8c58-4aa4-896d-f92aae987e8d
      iscommand: false
      name: DeleteContext
      script: DeleteContext
      type: regular
      version: -1
    taskid: b38e833a-8c58-4aa4-896d-f92aae987e8d
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 265,
          "y": 545
        }
      }
  "5":
    id: "5"
    ignoreworker: false
    nexttasks:
      '#none#':
      - "6"
    note: false
    quietmode: 0
    scriptarguments:
      all_results: {}
      export: {}
      limit: {}
      retry-count:
        simple: "10"
      search_name:
        simple: ${inputs.search_name}
      statistics: {}
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Get compliance search from the Security & Compliance Center.
      id: da016ca8-d295-4321-80e0-600878729044
      iscommand: true
      name: Get search
      script: '|||o365-sc-get-search'
      type: regular
      version: -1
    taskid: da016ca8-d295-4321-80e0-600878729044
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 265,
          "y": 895
        }
      }
  "6":
    conditions:
    - condition:
      - - left:
            iscontext: true
            value:
              simple: O365.SecurityAndCompliance.ContentSearch.Search.ExchangeLocation
          operator: notContainsGeneral
          right:
            value:
              simple: notexists@demistodev.onmicrosoft.com
      label: "yes"
    id: "6"
    ignoreworker: false
    nexttasks:
      '#default#':
      - "10"
      "yes":
      - "7"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: 'Validate compliance search modified with all additional arguments. '
      id: 92310529-6825-47f0-8d6b-8943c216b6b6
      iscommand: false
      name: Validate !o365-sc-get-search and !o365-sc-set-search commands
      type: condition
      version: -1
    taskid: 92310529-6825-47f0-8d6b-8943c216b6b6
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 265,
          "y": 1070
        }
      }
  "7":
    id: "7"
    ignoreworker: false
    nexttasks:
      '#none#':
      - "8"
    note: false
    quietmode: 0
    scriptarguments:
      all:
        simple: "yes"
      index: {}
      key: {}
      keysToKeep: {}
      subplaybook: {}
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Delete field from context
      id: b2ab8192-5636-4e96-8fdf-d6d43ea77850
      iscommand: false
      name: DeleteContext
      script: DeleteContext
      type: regular
      version: -1
    taskid: b2ab8192-5636-4e96-8fdf-d6d43ea77850
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 377.5,
          "y": 1245
        }
      }
  "8":
    id: "8"
    ignoreworker: false
    nexttasks:
      '#none#':
      - "9"
    note: false
    quietmode: 0
    scriptarguments:
      retry-count:
        simple: "10"
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: List compliance searches in the Security & Compliance Center.
      id: d0542cb3-bec4-4cce-8aec-8f08e05e01c0
      iscommand: true
      name: List search
      script: '|||o365-sc-list-search'
      type: regular
      version: -1
    taskid: d0542cb3-bec4-4cce-8aec-8f08e05e01c0
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 377.5,
          "y": 1420
        }
      }
  "9":
    conditions:
    - condition:
      - - left:
            iscontext: true
            value:
              simple: O365.SecurityAndCompliance.ContentSearch.Search.Name
          operator: isNotEmpty
      label: "yes"
    id: "9"
    ignoreworker: false
    nexttasks:
      '#default#':
      - "10"
      "yes":
      - "12"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: 'Validate compliance search list. '
      id: be794c4c-4cf3-459c-859e-004d5932b43e
      iscommand: false
      name: Validate !o365-sc-list-search command
      type: condition
      version: -1
    taskid: be794c4c-4cf3-459c-859e-004d5932b43e
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 377.5,
          "y": 1595
        }
      }
  "10":
    id: "10"
    ignoreworker: false
    nexttasks:
      '#none#':
      - "26"
    note: false
    quietmode: 0
    scriptarguments:
      retry-count:
        simple: "10"
      search_name:
        simple: ${inputs.search_name}
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Remove compliance search by name from the Security & Compliance
        Center.
      id: 37335942-6f32-49c4-8214-6377cb85af18
      iscommand: true
      name: Remove search
      script: '|||o365-sc-remove-search'
      type: regular
      version: -1
    taskid: 37335942-6f32-49c4-8214-6377cb85af18
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 50,
          "y": 2995
        }
      }
  "12":
    id: "12"
    ignoreworker: false
    nexttasks:
      '#none#':
      - "21"
    note: false
    quietmode: 0
    scriptarguments:
      all:
        simple: "yes"
      index: {}
      key: {}
      keysToKeep: {}
      subplaybook: {}
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Delete field from context
      id: 57537fe1-05b6-47d3-8058-8c9f094e672a
      iscommand: false
      name: DeleteContext
      script: DeleteContext
      type: regular
      version: -1
    taskid: 57537fe1-05b6-47d3-8058-8c9f094e672a
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 490,
          "y": 1770
        }
      }
  "16":
    id: "16"
    ignoreworker: false
    note: false
    quietmode: 0
    scriptarguments:
      message:
        simple: Fail executing test playbook
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Prints an error entry with a given message
      id: 5d5d6f10-09fb-4498-85e7-b56239db5e56
      iscommand: false
      name: PrintErrorEntry
      script: PrintErrorEntry
      type: regular
      version: -1
    taskid: 5d5d6f10-09fb-4498-85e7-b56239db5e56
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 50,
          "y": 3520
        }
      }
  "18":
    conditions:
    - condition:
      - - left:
            iscontext: true
            value:
              simple: O365.SecurityAndCompliance.ContentSearch.SearchAction.Results
          operator: isNotEmpty
      label: "yes"
    id: "18"
    ignoreworker: false
    nexttasks:
      '#default#':
      - "10"
      "yes":
      - "23"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 5721f3ac-1911-4537-8507-53bda907359d
      iscommand: false
      name: Validate !o365-sc-new-search-action (Generic polling playbook) and !o365-sc-get-search-action
      type: condition
      version: -1
    taskid: 5721f3ac-1911-4537-8507-53bda907359d
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 602.5,
          "y": 2820
        }
      }
  "19":
    id: "19"
    ignoreworker: false
    nexttasks:
      '#none#':
      - "18"
    note: false
    quietmode: 0
    scriptarguments:
      export: {}
      limit: {}
      results:
        simple: "true"
      retry-count:
        simple: "10"
      search_action_name:
        simple: ${O365.SecurityAndCompliance.ContentSearch.SearchAction.Name}
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Get compliance search action from the Security & Compliance Center.
      id: 5768a9b0-aa04-4872-85aa-c5b45af7dfac
      iscommand: true
      name: Get search action
      script: '|||o365-sc-get-search-action'
      type: regular
      version: -1
    taskid: 5768a9b0-aa04-4872-85aa-c5b45af7dfac
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 602.5,
          "y": 2645
        }
      }
  "20":
    id: "20"
    ignoreworker: false
    nexttasks:
      '#none#':
      - "31"
    note: false
    quietmode: 0
    scriptarguments:
      all:
        simple: "yes"
      index: {}
      key: {}
      keysToKeep: {}
      subplaybook: {}
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Delete field from context
      id: ad6f88f4-68ba-4abd-85f5-cb1de86fd830
      iscommand: false
      name: DeleteContext
      script: DeleteContext
      type: regular
      version: -1
    taskid: ad6f88f4-68ba-4abd-85f5-cb1de86fd830
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 602.5,
          "y": 2295
        }
      }
  "21":
    id: "21"
    ignoreworker: false
    nexttasks:
      '#none#':
      - "22"
    note: false
    quietmode: 0
    scriptarguments:
      retry-count:
        simple: "10"
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: List compliance search actions from the Security & Compliance Center.
      id: ef2b40e9-5921-40b7-8f1a-46c12df69beb
      iscommand: true
      name: List search actions
      script: '|||o365-sc-list-search-action'
      type: regular
      version: -1
    taskid: ef2b40e9-5921-40b7-8f1a-46c12df69beb
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 490,
          "y": 1945
        }
      }
  "22":
    conditions:
    - condition:
      - - left:
            iscontext: true
            value:
              simple: O365.SecurityAndCompliance.ContentSearch.SearchAction
          operator: isNotEmpty
      label: "yes"
    id: "22"
    ignoreworker: false
    nexttasks:
      '#default#':
      - "10"
      "yes":
      - "20"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: 'Validate compliance search actions list. '
      id: a23f2320-1455-459d-859c-5e7814f7f083
      iscommand: false
      name: Validate !o365-sc-list-search-action command
      type: condition
      version: -1
    taskid: a23f2320-1455-459d-859c-5e7814f7f083
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 490,
          "y": 2120
        }
      }
  "23":
    id: "23"
    ignoreworker: false
    nexttasks:
      '#none#':
      - "24"
    note: false
    quietmode: 0
    scriptarguments:
      retry-count:
        simple: "10"
      search_action_name:
        simple: ${O365.SecurityAndCompliance.ContentSearch.SearchAction.Name}
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Remove compliance search action by search action name from the
        Security & Compliance Center.
      id: afe230a8-8629-4f5a-83a4-5ae245707417
      iscommand: true
      name: Remove search action
      script: '|||o365-sc-remove-search-action'
      type: regular
      version: -1
    taskid: afe230a8-8629-4f5a-83a4-5ae245707417
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 612.5,
          "y": 2995
        }
      }
  "24":
    id: "24"
    ignoreworker: false
    nexttasks:
      '#none#':
      - "3"
    note: false
    quietmode: 0
    scriptarguments:
      retry-count:
        simple: "10"
      search_name:
        simple: ${inputs.search_name}
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Stop running compliance search in the Security & Compliance Center.
      id: 936e864b-649b-4a26-87bc-9e38e5411b75
      iscommand: true
      name: Stop search
      script: '|||o365-sc-stop-search'
      type: regular
      version: -1
    taskid: 936e864b-649b-4a26-87bc-9e38e5411b75
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 612.5,
          "y": 3170
        }
      }
  "25":
    id: "25"
    ignoreworker: false
    nexttasks:
      '#none#':
      - "5"
    note: false
    quietmode: 0
    scriptarguments:
      add_exchange_location: {}
      add_exchange_location_exclusion: {}
      add_public_folder_location: {}
      add_share_point_location: {}
      add_share_point_location_exclusion: {}
      allow_not_found_exchange_locations:
        simple: "false"
      description: {}
      kql: {}
      remove_exchange_location:
        simple: notexists@demistodev.onmicrosoft.com
      remove_exchange_location_exclusion: {}
      remove_public_folder_location: {}
      remove_share_point_location: {}
      remove_share_point_location_exclusion: {}
      retry-count:
        simple: "10"
      search_name:
        simple: ${inputs.search_name}
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Modify non-running compliance search in the Security & Compliance
        Center.
      id: e32eee51-4965-4434-8c5e-3f2e8e60ab97
      iscommand: true
      name: Set search
      script: '|||o365-sc-set-search'
      type: regular
      version: -1
    taskid: e32eee51-4965-4434-8c5e-3f2e8e60ab97
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 265,
          "y": 720
        }
      }
  "26":
    conditions:
    - condition:
      - - left:
            iscontext: true
            value:
              simple: O365.SecurityAndCompliance.ContentSearch.SearchAction.Name
          operator: isNotEmpty
      label: "yes"
    id: "26"
    ignoreworker: false
    nexttasks:
      '#default#':
      - "16"
      "yes":
      - "27"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: cc4286a5-b64d-4a12-8bc4-26149e176348
      iscommand: false
      name: Check if search action created
      type: condition
      version: -1
    taskid: cc4286a5-b64d-4a12-8bc4-26149e176348
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 50,
          "y": 3170
        }
      }
  "27":
    id: "27"
    ignoreworker: false
    nexttasks:
      '#none#':
      - "16"
    note: false
    quietmode: 0
    scriptarguments:
      retry-count:
        simple: "10"
      search_action_name:
        simple: ${O365.SecurityAndCompliance.ContentSearch.SearchAction.Name}
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Remove compliance search action by search action name from the
        Security & Compliance Center.
      id: 9ac72d56-036e-4179-8fa0-ad963faccb25
      iscommand: true
      name: Remove search action
      script: '|||o365-sc-remove-search-action'
      type: regular
      version: -1
    taskid: 9ac72d56-036e-4179-8fa0-ad963faccb25
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 182.5,
          "y": 3345
        }
      }
  "29":
    id: "29"
    ignoreworker: false
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: c798d10b-805e-4c3c-864a-f2ab9f4c8557
      iscommand: false
      name: Test playbook finished successfully
      type: title
      version: -1
    taskid: c798d10b-805e-4c3c-864a-f2ab9f4c8557
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 612.5,
          "y": 3535
        }
      }
  "30":
    id: "30"
    ignoreworker: false
    loop:
      exitCondition: ""
      iscommand: false
      max: 100
      wait: 1
    nexttasks:
      '#none#':
      - "2"
    note: false
    quietmode: 0
    scriptarguments:
      ' exchange_location_exclusion': {}
      allow_not_found_exchange_locations:
        complex:
          root: inputs.allow_not_found_exchange_locations
      case: {}
      description:
        complex:
          root: inputs.description
      exchange_location:
        complex:
          root: inputs.exchange_location
      force:
        simple: "true"
      kql:
        complex:
          root: inputs.kql
      preview:
        simple: "false"
      public_folder_location: {}
      search_name:
        complex:
          root: inputs.search_name
      share_point_location: {}
      share_point_location_exclusion: {}
    separatecontext: true
    skipunavailable: false
    task:
      brand: ""
      id: 751821ef-2a31-4985-8844-ad637e8c97cb
      iscommand: false
      name: O365 - Security And Compliance - Search
      playbookId: 02ba1f15-f35e-472e-8db9-de255a556400
      type: playbook
      version: -1
    taskid: 751821ef-2a31-4985-8844-ad637e8c97cb
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": 152.5,
          "y": 195
        }
      }
  "31":
    id: "31"
    ignoreworker: false
    loop:
      exitCondition: ""
      iscommand: false
      max: 100
      wait: 1
    nexttasks:
      '#none#':
      - "19"
    note: false
    quietmode: 0
    scriptarguments:
      search_name:
        complex:
          root: inputs.search_name
    separatecontext: true
    skipunavailable: false
    task:
      brand: ""
      id: b7a522ee-947b-4152-8ea1-20fe84fa1883
      iscommand: false
      name: O365 - Security And Compliance - Search Action - Preview
      playbookId: 07b3dea6-6818-4e61-879f-1859f09a5ca3
      type: playbook
      version: -1
    taskid: b7a522ee-947b-4152-8ea1-20fe84fa1883
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": 602.5,
          "y": 2480
        }
      }
version: -1
view: |-
  {
    "linkLabelsPosition": {},
    "paper": {
      "dimensions": {
        "height": 3565,
        "width": 942.5,
        "x": 50,
        "y": 50
      }
    }
  }
fromversion: 5.5.0
